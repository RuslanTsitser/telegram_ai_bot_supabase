# Load Stats API

Функция для получения общей статистики системы.

## Endpoint
```
https://your-project.supabase.co/functions/v1/load-stats
```

## Метод
**GET** - получение статистики системы

## Параметры запроса

Функция не принимает параметров запроса.

## Пример запроса

```bash
curl -X GET "https://your-project.supabase.co/functions/v1/load-stats" \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

## Ответ

```json
{
  "success": true,
  "data": {
    "total_users": 1250,
    "total_analyses": 15680,
    "avg_score": 7.2,
    "traffic_source": [
      { "source": null, "count": 1050 },
      { "source": "channel_name", "count": 150 },
      { "source": "other_source", "count": 50 }
    ]
  }
}
```

## Поля статистики

| Поле | Тип | Описание |
|------|-----|----------|
| `total_users` | number | Общее количество пользователей в системе |
| `total_analyses` | number | Общее количество анализов еды |
| `avg_score` | number | Средняя оценка питательности (округлено до 1 знака) |
| `traffic_source` | array | Распределение пользователей по источникам трафика. Массив объектов с полями `source` (string \| null) и `count` (number). Отсортировано по количеству пользователей по убыванию |

## Особенности расчета

### Общее количество пользователей
- Подсчитывается количество записей в таблице `users`
- Включает всех зарегистрированных пользователей

### Общее количество анализов
- Подсчитывается количество записей в таблице `food_analysis`
- Включает все проведенные анализы еды

### Средняя оценка питательности
- Рассчитывается как среднее арифметическое всех оценок `nutrition_score`
- Исключаются записи с `null` значениями
- Округляется до 1 знака после запятой
- Может быть `null` если нет анализов с оценками

### Распределение по источникам трафика
- Группирует пользователей по полю `traffic_source` из таблицы `users`
- Подсчитывает количество пользователей для каждого источника
- Источники с `null` значением также включены в статистику
- Результаты отсортированы по количеству пользователей по убыванию
- Каждый элемент массива содержит:
  - `source` - название источника трафика (может быть `null`)
  - `count` - количество пользователей из этого источника

## Коды ошибок

- `500` - Внутренняя ошибка сервера

## Особенности

- **Быстрый доступ** - функция оптимизирована для быстрого получения статистики
- **Агрегированные данные** - возвращает только сводную информацию
- **CORS поддержка** - функция поддерживает кросс-доменные запросы
- **Административная функция** - предназначена для мониторинга системы
- **Дашборд** - идеально подходит для отображения на административной панели
- **Мониторинг** - полезна для отслеживания роста пользовательской базы
