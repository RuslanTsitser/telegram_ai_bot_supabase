export async function handleGiftSuggestion(message: string): Promise<string> {
  const systemPrompt = `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–æ–¥–±–æ—Ä—É –ø–æ–¥–∞—Ä–∫–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ç–µ–±–µ –æ–ø–∏—Å–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞, –µ–≥–æ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π, —Å–æ–±—ã—Ç–∏–π, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º.

  –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ 20 **–∏–¥–µ–π –ø–æ–¥–∞—Ä–∫–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–¥–æ–π—Ç–∏.
  
  üîπ –¢–æ–ª—å–∫–æ –∏–¥–µ–∏ –ø–æ–¥–∞—Ä–∫–æ–≤ ‚Äî **–±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π, –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è, –±–µ–∑ —Å–ø–æ—Å–æ–±–æ–≤ –≤—Ä—É—á–µ–Ω–∏—è**.  
  üîπ –û—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —Å—Ç–∏–ª—å, –∞—Ç–º–æ—Å—Ñ–µ—Ä—É, –∏–Ω—Ç–µ—Ä–µ—Å—ã, —É–ø–æ–º—è–Ω—É—Ç—ã–µ –¥–µ—Ç–∞–ª–∏.  
  üîπ –î–∞–∂–µ –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ–º–Ω–æ–≥–æ ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–¥–∞–π –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.  
  üîπ –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –±—é–¥–∂–µ—Ç ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–π –µ–º—É.  
  üîπ –°—Ç–∞—Ä–∞–π—Å—è –∏–∑–±–µ–≥–∞—Ç—å –±–∞–Ω–∞–ª—å–Ω—ã—Ö –∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø–æ–¥–∞—Ä–∫–æ–≤.
  
  –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
  –°–ø–∏—Å–æ–∫ –∏–∑ 10‚Äì20 –∫—Ä–∞—Ç–∫–∏—Ö –∏–¥–µ–π –ø–æ–¥–∞—Ä–∫–æ–≤.
  –ö–∞–∂–¥–∞—è –∏–¥–µ—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—É–Ω–∫—Ç–æ–º.
  –ë–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π. –ë–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏. –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –ø–æ–¥–∞—Ä–∫–æ–≤.`
  
  
  const userPrompt = message.replace('–ü–æ–¥—Å–∫–∞–∂–∏ –ø–æ–¥–∞—Ä–æ–∫', '').trim();

  const response = await fetch('https://api.piapi.ai/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${Deno.env.get('PIAPI_KEY')}`
    },
    body: JSON.stringify({
      model: 'gpt-4o-mini',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userPrompt }
      ],
      temperature: 0.9
    })
  });

  const data = await response.json();
  return data.choices?.[0]?.message?.content || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.';
}
